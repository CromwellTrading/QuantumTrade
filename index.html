<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantum Signal Trader</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="particles"></div>

    <!-- Panel de Debug -->
    <div class="debug-panel">
        <div class="debug-header">üîç DEBUG PANEL - DETECCI√ìN DE ID</div>
        <div id="debugInfo" class="debug-info">Iniciando detecci√≥n...</div>
    </div>

    <!-- Notificaci√≥n -->
    <div id="notification" class="notification"></div>

    <!-- Alerta de Se√±al -->
    <div id="signalAlert" class="signal-alert">
        <div class="asset" id="alertAsset">EUR/USD</div>
        <div class="direction" id="alertDirection">
            <span class="arrow">‚Üë</span>
            <span>ALZA</span>
        </div>
        <div class="time-remaining" id="alertTime">Expira en: 05:00</div>
        <button id="closeAlert" class="btn btn-primary" style="margin-top: 20px;">
            <i class="fas fa-check"></i> ENTENDIDO
        </button>
    </div>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="logo">
                <i class="fas fa-satellite-dish"></i> QUANTUM TRADER
            </div>
            <div class="subtitle">Sistema de Se√±ales de Trading en Tiempo Real</div>
            
            <div class="user-info">
                <div id="userIdDisplay" class="user-badge regular">
                    <i class="fas fa-user"></i> ID: Cargando...
                </div>
                <div id="userStatus" class="session-info">
                    <i class="fas fa-user"></i> Estado: Cargando...
                </div>
            </div>
        </div>

        <!-- Navegaci√≥n -->
        <div class="nav-tabs">
            <button id="showSignals" class="nav-btn active">
                <i class="fas fa-chart-line"></i> Se√±ales
            </button>
            <button id="showStats" class="nav-btn">
                <i class="fas fa-chart-bar"></i> Estad√≠sticas
            </button>
            <button id="showUsers" class="nav-btn" style="display: none;">
                <i class="fas fa-users"></i> Usuarios
            </button>
            <button id="vipAccess" class="nav-btn">
                <i class="fas fa-crown"></i> VIP
            </button>
            <button id="adminBtn" class="nav-btn" style="display: none;">
                <i class="fas fa-user-shield"></i> Panel Admin
            </button>
            <button id="readyBtn" class="nav-btn">
                <i class="fas fa-bell"></i> PREPARADOS
            </button>
        </div>

        <!-- Panel de Se√±ales -->
        <div id="signalsPanel" class="panel active">
            <div class="signal-form">
                <div class="form-group">
                    <label for="asset"><i class="fas fa-coins"></i> Activo</label>
                    <input type="text" id="asset" class="form-control" placeholder="Ej: EURUSD, BTCUSD">
                </div>
                <div class="form-group">
                    <label for="timeframe"><i class="fas fa-clock"></i> Timeframe (min)</label>
                    <select id="timeframe" class="form-control">
                        <option value="1">1 minuto</option>
                        <option value="3">3 minutos</option>
                        <option value="5" selected>5 minutos</option>
                        <option value="15">15 minutos</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="direction"><i class="fas fa-arrows-alt-v"></i> Direcci√≥n</label>
                    <select id="direction" class="form-control">
                        <option value="up">ALZA (CALL)</option>
                        <option value="down">BAJA (PUT)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>&nbsp;</label>
                    <button id="sendSignal" class="btn btn-primary">
                        <i class="fas fa-paper-plane"></i> ENVIAR SE√ëAL
                    </button>
                </div>
            </div>

            <div id="signalsContainer">
                <div class="empty-state">
                    <i class="fas fa-satellite-dish"></i>
                    <p>Esperando se√±ales de trading...</p>
                    <p>Las se√±ales aparecer√°n aqu√≠ autom√°ticamente</p>
                </div>
            </div>
        </div>

        <!-- Panel de Estad√≠sticas -->
        <div id="statsContainer" class="panel">
            <div class="stats-cards">
                <div class="stat-card stat-profit">
                    <i class="fas fa-check-circle"></i>
                    <div class="stat-label">Operaciones Ganadas</div>
                    <div class="stat-value" id="winCount">0</div>
                </div>
                <div class="stat-card stat-loss">
                    <i class="fas fa-times-circle"></i>
                    <div class="stat-label">Operaciones Perdidas</div>
                    <div class="stat-value" id="lossCount">0</div>
                </div>
                <div class="stat-card stat-total">
                    <i class="fas fa-chart-line"></i>
                    <div class="stat-label">Total Operaciones</div>
                    <div class="stat-value" id="totalCount">0</div>
                </div>
            </div>

            <div class="time-filters">
                <button class="time-filter active" data-period="day">Hoy</button>
                <button class="time-filter" data-period="week">Esta Semana</button>
                <button class="time-filter" data-period="month">Este Mes</button>
            </div>

            <div class="chart-container">
                <canvas id="performanceChart"></canvas>
            </div>

            <table class="operations-table">
                <thead>
                    <tr>
                        <th>Activo</th>
                        <th>Direcci√≥n</th>
                        <th>Duraci√≥n</th>
                        <th>Estado</th>
                        <th>Fecha/Hora</th>
                    </tr>
                </thead>
                <tbody id="operationsTable">
                    <!-- Las operaciones se cargar√°n aqu√≠ -->
                </tbody>
            </table>
        </div>

        <!-- Panel de Usuarios (Admin) -->
        <div id="usersContainer" class="panel">
            <div class="admin-card">
                <h3><i class="fas fa-search"></i> Buscar Usuario</h3>
                <div class="user-search">
                    <input type="text" id="userSearchInput" class="form-control" placeholder="ID de Telegram">
                    <button id="searchUserBtn" class="btn btn-primary">Buscar</button>
                </div>
                <div id="userSearchResult" style="display: none; margin-top: 15px;"></div>
                <div id="userActions" style="display: none; gap: 10px; margin-top: 15px; justify-content: center;">
                    <button id="makeVipBtn" class="btn btn-vip">Hacer VIP</button>
                    <button id="removeVipBtn" class="btn btn-loss">Quitar VIP</button>
                </div>
            </div>

            <div class="admin-card">
                <h3><i class="fas fa-users"></i> Todos los Usuarios</h3>
                <button id="refreshUsers" class="btn btn-primary" style="margin-bottom: 15px;">
                    <i class="fas fa-sync"></i> Actualizar Lista
                </button>
                <table class="users-table">
                    <thead>
                        <tr>
                            <th>ID Telegram</th>
                            <th>Usuario</th>
                            <th>Estado VIP</th>
                            <th>Expiraci√≥n</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="usersTableBody">
                        <!-- Los usuarios se cargar√°n aqu√≠ -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Panel de Control de Sesi√≥n -->
        <div class="panel">
            <div class="admin-controls">
                <div class="admin-card">
                    <h3><i class="fas fa-play-circle"></i> Control de Sesi√≥n</h3>
                    <div id="sessionInfo" class="session-info">
                        <i class="fas fa-stop-circle"></i> Sesi√≥n no iniciada
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 15px; justify-content: center;">
                        <button id="startSession" class="btn btn-primary">Iniciar Sesi√≥n</button>
                        <button id="endSession" class="btn btn-loss" disabled>Finalizar Sesi√≥n</button>
                    </div>
                </div>

                <div class="admin-card">
                    <h3><i class="fas fa-bell"></i> Notificaciones</h3>
                    <p style="margin-bottom: 15px; color: #ccc;">Notificar a todos los usuarios</p>
                    <button id="notifyClients" class="btn btn-vip">
                        <i class="fas fa-broadcast-tower"></i> Notificar en 10 min
                    </button>
                </div>
            </div>
        </div>

        <!-- Modal VIP -->
        <div id="vipModal" class="panel" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 1000; max-width: 500px; width: 90%;">
            <div class="admin-card">
                <h3><i class="fas fa-crown"></i> Acceso VIP</h3>
                <p style="margin-bottom: 20px; color: #ccc;">
                    El acceso VIP te permite recibir todas las se√±ales de trading en tiempo real.
                    Contacta con el administrador para obtener acceso VIP.
                </p>
                <button id="closeVipModal" class="btn btn-primary">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- Estado de Conexi√≥n -->
    <div id="connectionStatus" class="connection-status">
        <div class="status-dot status-connected" id="statusDot"></div>
        <span id="statusText">Conectado al servidor</span>
    </div>

    <script src="script.js"></script>
</body>
</html>
